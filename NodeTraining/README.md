# Node JS Training

Instructor: Alain (Al)  </br>
Email: al@interstate21.com </br>

[Day 1](https://goo.gl/qcqPcB)

[Day 2](https://goo.gl/e1Cj86)

[Github](https://github.com/alcfeoh/di-node-js)


Q: Slide 28 Lab 3 (first lab for me); How did I know to use process
(how does that work) it was explained before lunch

Q: How to read the documentation to fill in the parameters
- common to see [ , ]

  
Q: Explain the function on slide 30
 

Q: For debugger, how did you know what command to run on the command line?
 —inspect 

 
MEAN Stack = Mongo Express Angular Node


#### Express

- Express is used to create a HTTP Server
- Used it to make routes
- / is the default route == localhost 3000
- .use doesn’t matter what type of request (it's a shortcut, can handle
anything post, get, etc)
- Middleware have up to 3 parameters (request, response, and next)


# Day 1


### Introduction to Node.JS


#### What/Why Node.JS?
- Node.JS is a **JavaScript** runtime built on **Chrome's V8 JavaScript engine
- Node.JS uses an event-driven, non-blocking I/O model that makes it
lightweight and efficient. As a result, most operations in Node.JS are
**asynchronous**
- Node.JS's package ecosystem, **npm**, is the largest ecosystem of open source
libraries in the world.
- Unlike older browsers, ***Chrome was built for JS first***. As a result. Its
engine is really fast.
- If JS runs fast in the browser, why not use it on the server or on any
desktop as well?
- As a result, the exported Chrome V8 engine became Node.JS, with the addition
of extra libraries to do things that are not allowed in JS: Reading files,
connecting to databases, etc.


#### How to use Node.JS?
- Node.JS is added to the path of your operating system. As a result, you can
simply use it with the command: `node [filename]`
- Node.JS can also be used in interactive mode, just like the browser console
of Google Chrome. To do so, simply run: `node`


### Introduction to NPM


#### What is NPM?
- Node Package Manager is 2 things:
	- Online repository for publishing open-source code
	- Command-line utility for interacting with said repository that aids in
	package installation, version management, and dependency management
	- NPM is automatically installed with Node.JS
	- NPM is the most popular package manager for the web


#### npm install
- `npm install` is the most used command with npm
- For instance, running `npm install typescript` will download Typescript and
all of its dependencies into a `node_modules`folder created in the current
folder
- As a result, most installs are specific to one project
- In order to install a package globally, you can use the `-g` option:
`npm install -g typescript`


#### npm install , npm update, npm uninstall
- It is also possible to specify which version we want to install:
`npm install my-package@1.2.0`
- You can also use npm update to get the latest version of all packages and
dependencies of your current project: `npm update`
- How to uninstall? `npm uninstall my-package`


#### package.json
- Production projects have several dependencies with specific version
requirements that have to be enforced for all developers
- `package.json` is a JSON file that can store all of these versions in one
single reference file:
- `package.json` can be generated by running `npm init`
- When running `npm install` in a folder, `npm` will look for a `package.json`
file, and if there is one, will use it to download all of the dependencies
listed in it.
- Note that `package.json` also has a specific section for development-specific
dependencies that should not be part of your production code:


#### npm install with package.json
- It is possible to persist our installs in package.json automatically:
`npm install my-package --save`
- The same also applies to dev-only dependencies:
`npm install my-package --save-dev`
- And this works with uninstall as well: `npm uninstall my-package --save`


### Command line apps with Node.JS


#### How to pass arguments to a Node.JS app?
- Any arguments passed to a Node.JS app can be accessed via: `process.argv`
- For instance, given the following command: `node myapp.js aParamValue `
- `process.argv[0]` is equal to `C:\Path\to\nodejs\node.exe`
- `process.argv[1]` is equal to `C:\Path\to\myapp\myapp.js`
- `process.argv[2]` is equal to `aParamValue`
- Any other parameters would be added to that array at indexes 3, 4, etc.


#### Other options for command line apps
- `Commander` is a simple package that allows you to define different options for
your command line app
- `Prompt` is a simple package that allows you to interact with the user by
asking questions


#### Scripts in package.json
- It is also possible to create custom scripts in `package.json` that can be
run with `npm run [script-name]`


### Global and Process objects


#### What is the global object?
- The global object is a global namespace object
- It contains references to all global objects like:
	- `console` - an object used to log some information
	- `require()` - the function used to load external modules
	- `process` - an object that has information about the current Node process
	- `setTimeout()`, `setInterval()` - timer functions used to run code
	asynchronously


#### What is the process object?
- The `process` object provides information about, and control over, the
current Node.JS process
- As a global, it is always available to Node.JS applications without using
`require()`
- Some examples of properties and methods of that object:
	- `argv`- array of parameters passed to the process
	- `cwd()` - returns the current working directory
	- `env` - returns system environment variables for the current user


#### How to debug Node.JS applications?
- We can hook Node.JS to the Google Chrome Developer tools in order to debug
Node.JS code
- To do so, open chrome://inspect in Chrome
- Then run your Node.JS app as follows: `node --inspect-brk file.js`


### Asynchronous Programming


#### Why is asynchronous programming important?
- Node.JS is **single-threaded**, yet claims to have an event-driven,
non-blocking I/O model that makes it lightweight and efficient
- How can Node be non-blocking if it has a single-thread? How could it
possibly handle multiple tasks at once in that case?
- The answer lies in a mechanism called the ***event loop***
- Whenever a task is handled ***asynchronously***, Node.JS will make it run
within the event loop, thus freeing Node’s main thread from that task


#### What is the event loop?
- It’s a mechanism that delegates tasks to worker threads of the OS
- Node periodically checks for updates from the event loop to be notified when
tasks are completed
- This is a ***single thread***
- If a process takes a long time, it will go into the event loop but still use
a single thread


#### How to handle asynchronous code?
- Whenever a task is asynchronous, we register a callback function that will be
invoked whenever the task completes.
- It is a very common practice in Node.JS: Callbacks are everywhere!


### Creating HTTP Servers/ Making HTTP requests


#### How to serve static files?
- The easiest way to serve static content is to use the `http-server` module
- It starts a local server on port 8080 that serves content from a local folder
of your choice
- If you want to change the port you can do `http-server -p 9000`


#### How to write a basic HTTP server?
- You can use the default `http module` from Node.JS
- Import the module, call http.createServer(), listen


#### How to write a more advanced HTTP server?
- Many modules exist to do that. ***Hapi*** is one possible option.
- ***Hapi*** is not a default Node.JS module and has to be installed through
npm


#### How to make a HTTP request?
- The `http module` of Node.JS is the default option but is a verbose one, you
would have to keep appending the response because the data comes in chunks,
after the data is all there, you can console log it...its a lot of work, so we
use modules to help us do this process


#### Making a HTTP request with node-fetch
- A much easier solution based on promises


### Creating Node Modules


#### How to create our own Node.JS module?
- Create a new directory and then run `npm init` in that directory
- An interactive prompt will ask for info about your module
- Then a default `package.json` will be created in that directory
- Create an `index.js` file with the contents of your Node module
- Once your module is ready to ship, use `npm publish` to make your module
available to the rest of the world!
- ***Note***: You will need to run `npm login` before being able to publish,
which requires a npm account


# Day 2


#### What is Express?
- Express is a web framework for building web applications, APIs and services
- http://expressjs.com


#### How to write a basic HTTP Server with Express?
- Config is similar to other server modules like express.


#### Express is based on middle ware functions
`app.get('/',function(req,res,next){
	next();
})
app.listen(3000);
`

- .get : HTTP method for which the middleware function applies
- '/' : Path (route) for which the middleware function applies
- function(req,res,next): The middleware function
- req: HTTP request argument to the function
- res: HTTP response argument to the function
- next: Callback argument to the next middleware function
- req, res, and next are parameter names used by convention, though actual
parameter names do not matter in javascript


### Error Handling


#### How to log errors with Express?
- Express automatically handles errors thrown in your code by logging them and
returning a HTTP 500 error along with the error stack
- It is possible to define our own error handler function, which has to be
declared with 4 parameters as follows:
	- `function logErrors (err, req, res, next){
			console.error(err);
			res.status(500).send('Server error');
		}`
- Parameters: **err** is the error object, **req** is the request, **res** is
the response, **next** is a function used to call the next error handler


#### Tweaking error handling in Express
- Several error handling functions can be defined and chained
- In Express, such functions are called **middleware** and rely on the `next()`
parameter to let Express pass the error to the next handler (if any):
	`function logErrors(err ,req, res, next){
	  console.error(err);
	  next(err);
	}`
- The above function has to be registered with `app.use(logErrors)` just before
starting the server, after all routes are defined


#### How to throw an error?
- We can simply use the throw syntax to throw an error
- Express error handler functions will then catch that error
- ***Note*** that Express has a default error handler that returns a HTTP 500
error
`app.get('error', (request,resp,next) =>){
	throw new Error("Something bad happened");
});`


### Integrating CORS with Express


#### What is CORS?
- CORS stands for **C**ross **O**rigin **R**esource Sharing 
- When enabled, it allows browsers to make cross-origin API calls, i.e.
domainx.com can send an HTTP request to domainy.com
- Browsers prevent CORS by default for safety reasons


#### How to enable CORS with Express?
- CORS requires the use of a specific middleware library called…. cors
- The middleware can be applied globally or for specific routes only


#### How to enable CORS for specific routes?
- The cors function can also take an optional config as a parameter if we want
to allow CORS for specific domains only


### Advanced Routing


#### Express supports all HTTP Requests
- So far we’ve been using HTTP GET, but we can send data to the server using
HTTP PUT and POST
`app.get('/', function(req,res){
		res.send("GET request");
});`
`app.post('/', function(req,res){
		res.send("POST request");
});`


#### How to extract request parameters?
- Parameters have to be specified in the path, then extracted using
`req.params`
- The name defined in the path corresponds to the name of the parameter in
`req.params`


#### Optional Parameter
- A question mark can be used to mark a parameter as optional
`app.get('/users/:userID?', function(req,res){
		res.send(req.params);
});`


#### Route config with string patterns
- This route path will match acd and abcd
	- `app.get('/ab?cd', function(req,res){
		res.send('ab?cd');
});`
- This route path with match abcd, abbcd, abbbcd, and so on
	- `app.get('/ab+cd', function(req,res){
		res.send('ab+cd');
});`
- This route path will match abcd, abxcd, abRANDOMcd, ab123cd, and so on
	- 	- `app.get('/ab*cd', function(req,res){
		res.send('ab*cd');
});`
- This route path will match /abce and /abcde
	- 	- `app.get('/ab(cd)?e', function(req,res){
		res.send('ab(cd)e');
});`


#### Route config with regular expressions
- This route path will match anything with an "a" in the route name
	-  `app.get('/a/', function(req,res){
		res.send('ab?cd');
});`
- This route path will match **butterfly** and **dragonfly** but not
 **butterflyman,dragonflyman**, and so on
	-  `app.get('/.*fly$/', function(req,res){
		res.send('/.*fly$/');
});`


### Templating with Express


#### Serving static files
- This code allows to serve the contents of the content folder at the /data URL.
`app.use('/data', express.static('content'));`
- As a result, a user trying to access `/data/index.html` would get the
`index.html` file located in the content folder


#### Custom templating engines
- Express allows us to create our own template rendering engine
In our example, our template syntax uses expressions like this: `#message#`
- Our engine is registered for the `ntl` extension
- All it does here is simple substitutions
- Views are defined in their own folder. They are files with a `.ntl` extension
such as `index.ntl`


#### Handlebars as a templating engine
- Popular template engines such as Handlebars has their own Node modules that
we can use out of the box
- All we have to do is register our template engine


### Building Restful APIs with Express


#### What does Restful mean?
- Rest stand for Representational State Transfer
- A Restful web service relies on HTTP methods to achieve different operations:
 	- `HTTP GET /plates` returns the list of all plates => GET = READ
 	- `HTTP GET /plates/{id}` returns a given plate
 	- `HTTP PUT /plates/{id}` updates a given plate => PUT = UPDATE
 	- `HTTP POST /plates` creates a new plate => POST = CREATE
 	- `HTTP DELETE /plates/{id}` deletes a given plate => DELETE = DELETE
- Rest is a convention, not an obligation
- Data used by Restful services uses the JSON syntax
(**J**ava**S**cript **O**bject **N**otation)


#### Our Server is already Restful
- But things can be improved: All of our code is in one single file right now,
which is not scalable
- We can move some routes to their own config file


#### Express Generator
- Express-generator is a package that generates the default structure of any
Express application